---
import { SEO } from "astro-seo";
import VerCount from "../common/verCount.astro";
import "@styles/base/init.css";
// Twitter 卡片类型定义
export type TwitterCardType = "summary" | "summary_large_image";

// 最小必要 SEO 配置
export interface Props {
  title: string;
  url?: URL | string;
  description: string;
  canonical?: URL | string;
  twitterSite?: string;
  noindex?: boolean;
  nofollow?: boolean;
  anyhead?: string;
  favicon?: string;
}

const props = Astro.props as Props;
const effectiveTitle = props.title;
const effectiveDescription = props.description;

const faviconPath = props.favicon || "/favicon.ico";

const openGraphConfig = {
  basic: {
    title: effectiveTitle,
    type: "website",
    image: faviconPath,
    url: props.canonical || props.url || Astro.url.href,
  },
  optional: {
    description: effectiveDescription,
    locale: "zh_CN",
  },
};

const twitterConfig = {
  card: "summary_large_image" as TwitterCardType,
  title: effectiveTitle,
  description: effectiveDescription,
  image: faviconPath,
  ...(props.twitterSite ? { site: props.twitterSite } : {}),
};

const extendedLink = [{ rel: "icon", href: faviconPath }];
const extendedMeta = [
  { name: "viewport", content: "width=device-width, initial-scale=1" },
];

const schema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  url: props.canonical || Astro.url.href,
  name: effectiveTitle,
  description: effectiveDescription,
};
const ldJson = JSON.stringify(schema);
---

<head>
  <meta charset="utf-8" />
  <SEO
    title={effectiveTitle}
    description={effectiveDescription}
    canonical={props.canonical}
    nofollow={props.nofollow || false}
    noindex={props.noindex || false}
    openGraph={openGraphConfig}
    twitter={twitterConfig}
    extend={{
      link: extendedLink,
      meta: extendedMeta,
    }}
  />
  {props.anyhead && <Fragment set:html={props.anyhead} />}
  <script type="application/ld+json" set:html={ldJson} />
  <VerCount />
</head>
