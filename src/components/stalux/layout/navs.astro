---
//@ts-ignore
import * as feather from "feather-icons"; // 导入 feather-icons 以便使用图标
import { getCollection } from "astro:content";
import styles from "@styles/components/layout/navs.module.css";
import Search from "@components/stalux/common/search.astro";
function getIconSvg(iconName: string): string {
    if (!iconName) return "";
    try {
        const icon = feather.icons[iconName];
        return icon
            ? icon.toSvg({
                  width: 20,
                  height: 20,
                  "stroke-width": 2,
                  class: "nav-icon",
              })
            : "";
    } catch (error) {
        console.error(`Icon '${iconName}' not found in feather-icons`);
        return "";
    }
}
const stalux = (await getCollection("config"))[0].data;
---

<nav aria-label="Main navigation">
    <!-- 汉堡菜单按钮 (仅窄屏显示) -->
    <button
        data-ref="stalux-nav-toggle"
        class={styles.navToggle}
        aria-label="打开导航菜单"
    >
        <Fragment set:html={getIconSvg("menu")} />
    </button>

    <!-- 侧边栏遮罩 -->
    <div data-ref="stalux-nav-overlay" class={styles.navOverlay}></div>

    <!-- 导航列表 -->
    <ul data-ref="stalux-nav-list" class={styles.navList}>
        {
            stalux.navs.map((item) => (
                <li class={styles.navItem}>
                    <a
                        href={item.link}
                        class={styles.navLink}
                        data-ref="stalux-nav-link"
                    >
                        {item.icon && (
                            <Fragment set:html={getIconSvg(item.icon)} />
                        )}
                        <span class={styles.navText}>{item.title}</span>
                    </a>
                </li>
            ))
        }
        <li class={styles.navItem}>
            <button
                class={styles.navLink}
                data-ref="stalux-search-btn"
                aria-label="打开搜索"
            >
                <Fragment set:html={getIconSvg("search")} />
                <span class={styles.navText}>搜索</span>
            </button>
        </li>
    </ul>
</nav>
<Search />
<script>
    const searchBtn = document.querySelector('[data-ref="stalux-search-btn"]');
    searchBtn?.addEventListener("click", () => {
        const event = new CustomEvent("openSearch");
        document.dispatchEvent(event);
    });

    // 汉堡菜单交互
    const navToggle = document.querySelector('[data-ref="stalux-nav-toggle"]');
    const navList = document.querySelector('[data-ref="stalux-nav-list"]');
    const navOverlay = document.querySelector(
        '[data-ref="stalux-nav-overlay"]',
    );

    function openNav() {
        navList?.setAttribute("data-state", "open");
        navOverlay?.setAttribute("data-state", "show");
        document.body.style.overflow = "hidden";
    }

    function closeNav() {
        navList?.removeAttribute("data-state");
        navOverlay?.removeAttribute("data-state");
        document.body.style.overflow = "";
    }

    navToggle?.addEventListener("click", openNav);
    navOverlay?.addEventListener("click", closeNav);

    // 点击导航链接后关闭侧边栏
    const navLinks = document.querySelectorAll('[data-ref="stalux-nav-link"]');
    navLinks?.forEach((link) => {
        link.addEventListener("click", closeNav);
    });
</script>
