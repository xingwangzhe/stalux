---
import style from "@styles/postCard.module.css";
import type { RenderedContent } from "astro:content";
import { stripHtml } from "string-strip-html";

type PostData = {
    title: string;
    date?: string | Date;
    updated?: string | Date;
    tags?: string[];
    categories?: string[];
    abbrlink?: string;
};

type PostLike = {
    data: PostData;
    description?: string;
    rendered?: RenderedContent;
};

export interface Props {
    post: PostLike;
}
const post = Astro.props.post as PostLike;
const description =
    post.description ??
    stripHtml(post.rendered?.html || "").result.slice(0, 100) + "...";
---

<a href={`/posts/${post.data.abbrlink}`} class={style.post + " a-none"}>
    <div class={style.postContainer}>
        <h2 class={style.postTitle}>{post.data.title}</h2>
        <div class={style.time}>
            {
                post.data.date && (
                    <time class={style.postDate}>
                        {new Date(post.data.date).toLocaleDateString()}
                    </time>
                )
            }
            {
                post.data.updated && (
                    <time class={style.postUpdated}>
                        {new Date(post.data.updated).toLocaleDateString()}
                    </time>
                )
            }
        </div>
        <div class={style.postDescription}>{description}</div>
        <div class={style.postMeta}>
            <div class={style.postTags}>
                {
                    post.data.tags?.map((tag) => (
                        <a class="a-none" href={`/tags/${tag}`}>
                            <div class={style.postTag}>{tag}</div>
                        </a>
                    ))
                }
            </div>
            <div class={style.postCategories}>
                {
                    post.data.categories?.map((category) => (
                        <a class="a-none" href={`/categories/${category}`}>
                            <div class={style.postCategory}>{category}</div>
                        </a>
                    ))
                }
            </div>
        </div>
        <a
            href={`/posts/${post.data.abbrlink}`}
            class={style.readMore + " a-none"}
        >
            Read More
        </a>
    </div>
</a>
